import{_ as A,T as R,b as U,a9 as I,R as C,a5 as L,r as m,o as S,aa as j,y as B,B as O,c as z,d as e,f as s,w as o,t as w,G as P,I as f,J as _,ab as E,K as V,h,i as D,q as M,ac as N,ad as F}from"./index-CdcUHPY5.js";const G=["image/jpeg","image/png","image/jpg"],q={name:"ProfileView",components:{TheIcon:R,TheButton:U,TheAvatar:I,RouterLink:C},setup(){const i=L(),{token:c}=P,d=m(),t=m(),l=m(""),y=()=>{URL.revokeObjectURL(l.value),l.value="",f({msg:_.UPLOAD_ERROR,messageType:"error",popupType:"alert"})},p=()=>{URL.revokeObjectURL(l.value),l.value="",d.value.value=null},x=()=>{const a=d.value.files[0];if(!a)return;const v=a.type;if(G.includes(v))l.value=URL.createObjectURL(a),t.value.showModal();else{f({msg:_.AVATAR_FORMAT_ERROR,messageType:"error",popupType:"alert"}),d.value.value=null;return}a.size>1024*1024*10&&(f({msg:_.AVATAR_SIZE_ERROR,messageType:"error",popupType:"alert"}),d.value.value=null)},n=async()=>{t.value.close();const a=f({msg:_.UPLOADING,messageType:"info",popupType:"alert",duration:8e3}),v=new FormData;v.append("avatar",d.value.files[0]);const b=await E(v);b&&b.code===200&&(a.close(),f({msg:_.UPLOAD_SUCCESS,messageType:"success",popupType:"toast",toastPos:["bottom","end"]}),setTimeout(()=>{V()},1e3))};S(async()=>{const a=await j(c.value);a&&a.code===200&&i.setUser(a.data)}),B(()=>{l.value&&URL.revokeObjectURL(l.value)});const{username:g,id:u,createdAt:k,logout:T}=i;return{BASE_URL:O,uid:u,username:g,createdAt:k,previewSrc:l,uploadAvatarInput:d,previewAvatarModal:t,previewAvatar:x,uploadError:y,cancelUpload:p,uploadAvatar:n,logout:T}}},r=i=>(N("data-v-3efc747e"),i=i(),F(),i),J={class:"absolute top-36 w-full px-3 md:px-4 lg:px-5"},K={class:"relative max-w-2xl w-full left-1/2 -translate-x-1/2 space-y-4 grid grid-cols-1 lg:grid-cols-2 lg:gap-x-3"},Z={class:"navbar rounded-xl bg-primary w-full text-sm px-4 lg:col-span-2"},H={class:"mx-4 lg:mx-6 flex-1"},Q={class:"text-xl lg:text-2xl tracking-wider font-Noto"},W={class:"navbar px-4 rounded-xl bg-primary w-full"},X={class:"flex-none lg:flex lg:flex-col lg:w-full lg:items-start lg:pl-2"},Y=r(()=>e("span",{class:"text-xl pr-4 tracking-widest text-white"},"UID",-1)),$={class:"text-sm tracking-wider"},ee={class:"navbar px-4 rounded-xl bg-primary w-full text-lg"},te=r(()=>e("span",{class:"pr-6 tracking-wider text-white font-base font-black"},"注册时间",-1)),se={class:"tracking-wide"},ae={class:"navbar px-4 rounded-box bg-primary w-full lg:col-span-2 flex font-base font-black"},oe=r(()=>e("span",{class:"whitespace-nowrap"},"我的收藏",-1)),le=r(()=>e("span",{class:"text-lg lg:text-xl flex-1 text-white font-Poppins"},">",-1)),ne=r(()=>e("div",{class:"divider divider-horizontal mx-3"},null,-1)),re=r(()=>e("span",{class:"whitespace-nowrap"},"历史浏览",-1)),ce=r(()=>e("span",{class:"text-lg flex-1 text-white font-Poppins"},">",-1)),ie={class:"modal",ref:"previewAvatarModal"},de={class:"modal-box bg-primary"},pe={method:"dialog"},ue={class:"relative flex justify-center z-0"},fe={class:"rounded-full h-28 w-28 md:h-32 md:w-32 lg:h-36 lg:w-36 overflow-hidden"},_e=["src"],ge={class:"flex justify-center"},ve=r(()=>e("span",{class:"font-base"},"上传",-1)),he={method:"dialog",class:"hidden lg:block mx-auto"},xe=r(()=>e("span",{class:"font-base"},"取消",-1)),me={method:"dialog",class:"modal-backdrop"};function we(i,c,d,t,l,y){const p=h("TheIcon"),x=h("TheAvatar"),n=h("TheButton"),g=h("router-link");return D(),z("main",J,[e("div",K,[e("div",Z,[s(n,{type:"secondary",shape:"circle",class:"relative size-20 lg:size-24 overflow-hidden"},{default:o(()=>[e("input",{type:"file",class:"hidden h-0 w-0",ref:"uploadAvatarInput",onChange:c[0]||(c[0]=(...u)=>t.previewAvatar&&t.previewAvatar(...u))},null,544),s(x,{class:"w-full hover:opacity-40 hover:scale-110 transition-all duration-500 z-20",onClick:c[1]||(c[1]=()=>t.uploadAvatarInput.click())},{default:o(()=>[s(p,{type:"user",size:"2xl",class:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 lg:text-3xl text-neutral"})]),_:1})]),_:1}),e("div",H,[e("span",Q,w(t.username),1)]),s(n,{type:"error",class:"z-50 h-10 lg:h-12 lg:w-20 lg:text-base font-base",onClick:t.logout},{default:o(()=>[M(" 登出 ")]),_:1},8,["onClick"])]),e("div",W,[e("div",X,[Y,e("span",$,w(t.uid),1)])]),e("div",ee,[te,e("span",se,w(t.createdAt),1)]),e("div",ae,[s(g,{to:{name:"favorite"},class:"btn btn-ghost flex-1 px-0 justify-start gap-4 flex-nowrap"},{default:o(()=>[s(n,{id:"favoriteBtn",type:"error",class:"bg-error/25 hover:bg-error/50 border-none xl:flex-1"},{default:o(()=>[s(p,{type:"heart",class:"text-error"})]),_:1}),oe,le]),_:1}),ne,s(g,{to:{name:"history"},class:"btn btn-ghost flex-1 px-0 justify-start gap-4 flex-nowrap"},{default:o(()=>[s(n,{id:"historyBtn",type:"info",class:"bg-info/25 hover:bg-info/50 border-none xl:flex-1"},{default:o(()=>[s(p,{type:"clock-rotate-left",class:"text-info"})]),_:1}),re,ce]),_:1})])]),e("dialog",ie,[e("div",de,[e("form",pe,[s(n,{type:"ghost",shape:"circle",class:"absolute right-0 top-0 z-10"},{default:o(()=>[s(p,{type:"xmark-circle",class:"text-lg"})]),_:1})]),e("div",ue,[e("div",fe,[e("img",{src:t.previewSrc,alt:"",class:"w-full h-full object-cover"},null,8,_e)])]),e("div",ge,[s(n,{type:"neutral",class:"w-32 lg:w-20 mx-auto my-3",onClick:t.uploadAvatar},{default:o(()=>[ve]),_:1},8,["onClick"]),e("form",he,[s(n,{type:"info",class:"w-20 my-3",onClick:t.cancelUpload},{default:o(()=>[xe]),_:1},8,["onClick"])])])]),e("form",me,[e("button",{onClick:c[2]||(c[2]=(...u)=>t.cancelUpload&&t.cancelUpload(...u))})])],512)])}const be=A(q,[["render",we],["__scopeId","data-v-3efc747e"]]);export{be as default};
